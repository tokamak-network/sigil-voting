# Design: ZK Private Voting System

> **Feature**: zk-private-voting
> **Phase**: Design
> **Created**: 2026-02-11
> **Status**: IN PROGRESS

---

## 1. ì„¤ê³„ ì›ì¹™

### 1.1 ìŠ¤í™ ì¤€ìˆ˜ (ì ˆëŒ€)
- D1/D2 ìŠ¤í™ì—ì„œ ë²—ì–´ë‚˜ì§€ ì•ŠìŒ
- ì»¨íŠ¸ë™íŠ¸ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ì •í™•íˆ ë§ì¶¤
- Commit-Reveal íë¦„ ì¤€ìˆ˜

### 1.2 íŠ¸ëœì­ì…˜ ì•ˆì •ì„±
- ê¸°ì¡´ Commit ë¡œì§ ë³€ê²½ ê¸ˆì§€
- ìƒˆ ê¸°ëŠ¥(Reveal)ì€ ë³„ë„ í•¨ìˆ˜ë¡œ ì¶”ê°€
- ê° ë‹¨ê³„ í›„ Sepolia TX í…ŒìŠ¤íŠ¸

### 1.3 ì½”ë“œ ìœ ì§€ë³´ìˆ˜ì„±
- ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬ (Phaseë³„)
- ë‹¨ì¼ ì±…ì„ ì›ì¹™
- 300ì¤„ ì´í•˜ íŒŒì¼

---

## 2. Phase ê¸°ë°˜ ì•„í‚¤í…ì²˜

### 2.1 Phase íë¦„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Proposal Lifecycle                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  [Phase 0: Commit]     [Phase 1: Reveal]    [Phase 2: Ended]â”‚
â”‚   now <= endTime    endTime < now <= revealEnd   now > revealEnd
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ íˆ¬í‘œ ì œì¶œ   â”‚  â†’   â”‚ íˆ¬í‘œ ê³µê°œ   â”‚  â†’   â”‚ ê²°ê³¼ í™•ì •   â”‚ â”‚
â”‚  â”‚ (ZK ì¦ëª…)   â”‚      â”‚ (choice+salt)â”‚      â”‚ (ì§‘ê³„ ì™„ë£Œ) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  í—ˆìš©: castVoteD2     í—ˆìš©: revealVoteD2    í—ˆìš©: ì¡°íšŒë§Œ    â”‚
â”‚  ê¸ˆì§€: reveal         ê¸ˆì§€: commit          ê¸ˆì§€: commit/reveal
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Phaseë³„ UI ë§¤í•‘
| Phase | UI ì»´í¬ë„ŒíŠ¸ | ì£¼ìš” ì•¡ì…˜ |
|-------|------------|----------|
| 0 (Commit) | VoteForm | íˆ¬í‘œ ì œì¶œ |
| 1 (Reveal) | RevealForm | íˆ¬í‘œ ê³µê°œ |
| 2 (Ended) | VoteResult | ê²°ê³¼ ì¡°íšŒ |

---

## 3. ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

### 3.1 ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
src/components/
â”œâ”€â”€ QuadraticVotingDemo.tsx    # ë©”ì¸ ì»¨í…Œì´ë„ˆ (ì¶•ì†Œ)
â”œâ”€â”€ voting/
â”‚   â”œâ”€â”€ index.ts               # ë‚´ë³´ë‚´ê¸°
â”‚   â”œâ”€â”€ PhaseIndicator.tsx     # Phase ìƒíƒœ í‘œì‹œ
â”‚   â”œâ”€â”€ VoteForm.tsx           # Commit Phase UI (ê¸°ì¡´ ë¶„ë¦¬)
â”‚   â”œâ”€â”€ RevealForm.tsx         # Reveal Phase UI (ì‹ ê·œ)
â”‚   â””â”€â”€ VoteResult.tsx         # Ended Phase UI (ì‹ ê·œ)
```

### 3.2 PhaseIndicator ì»´í¬ë„ŒíŠ¸
```typescript
interface PhaseIndicatorProps {
  phase: 0 | 1 | 2
  endTime: Date
  revealEndTime: Date
}

// UI:
// [Commit â—â”â”â”] â†’ [Reveal â—‹â”€â”€â”€] â†’ [ì¢…ë£Œ]
//  2ì¼ 3ì‹œê°„       ëŒ€ê¸° ì¤‘
```

**í‘œì‹œ ë¡œì§**:
- Phase 0: "íˆ¬í‘œ ì¤‘" + endTimeê¹Œì§€ ë‚¨ì€ ì‹œê°„
- Phase 1: "ê³µê°œ ì¤‘" + revealEndTimeê¹Œì§€ ë‚¨ì€ ì‹œê°„
- Phase 2: "ì¢…ë£Œ"

### 3.3 RevealForm ì»´í¬ë„ŒíŠ¸
```typescript
interface RevealFormProps {
  proposal: Proposal
  onRevealSuccess: () => void
}

interface StoredVote {
  choice: bigint      // 0 or 1
  numVotes: bigint
  voteSalt: bigint
  nullifier: bigint
  commitment: bigint
}
```

**UI ì„¤ê³„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“¢ ê³µê°œ ê¸°ê°„                                 â”‚
â”‚  ë‚¨ì€ ì‹œê°„: 23ì‹œê°„ 45ë¶„                        â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ë‚´ íˆ¬í‘œ ì •ë³´                             â”‚ â”‚
â”‚  â”‚ íˆ¬í‘œ ìˆ˜: 5í‘œ                             â”‚ â”‚
â”‚  â”‚ ìƒíƒœ: ê³µê°œ ëŒ€ê¸° ì¤‘                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                              â”‚
â”‚  [íˆ¬í‘œ ê³µê°œí•˜ê¸°]                              â”‚
â”‚                                              â”‚
â”‚  âš ï¸ ê³µê°œí•˜ì§€ ì•Šìœ¼ë©´ ì§‘ê³„ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ìƒíƒœ**:
- íˆ¬í‘œ ë°ì´í„° ì—†ìŒ â†’ "ì´ ì œì•ˆì— íˆ¬í‘œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤"
- íˆ¬í‘œ ë°ì´í„° ìˆìŒ + ë¯¸ê³µê°œ â†’ ê³µê°œ ë²„íŠ¼ í™œì„±í™”
- ì´ë¯¸ ê³µê°œë¨ â†’ "ê³µê°œ ì™„ë£Œ" í‘œì‹œ

### 3.4 VoteResult ì»´í¬ë„ŒíŠ¸
```typescript
interface VoteResultProps {
  proposal: Proposal
  forVotes: number
  againstVotes: number
  totalCommitments: number
  revealedVotes: number
}
```

**UI ì„¤ê³„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š íˆ¬í‘œ ì¢…ë£Œ                                 â”‚
â”‚                                              â”‚
â”‚  ì°¬ì„±  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  75í‘œ (71%)          â”‚
â”‚  ë°˜ëŒ€  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  30í‘œ (29%)          â”‚
â”‚                                              â”‚
â”‚  ì°¸ì—¬: 45ëª… | ê³µê°œ: 42ëª…                      â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ë‚´ íˆ¬í‘œ: ì°¬ì„± 5í‘œ (ê³µê°œ ì™„ë£Œ)             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. ë°ì´í„° íë¦„

### 4.1 Commit â†’ Reveal ë°ì´í„° ì—°ê²°
```
[Commit Phase]
    â”‚
    â”œâ”€ handleVote() ì‹¤í–‰
    â”‚   â”œâ”€ ZK ì¦ëª… ìƒì„±
    â”‚   â”œâ”€ approveAndCall TX
    â”‚   â””â”€ storeD2VoteForReveal() â† localStorage ì €ì¥
    â”‚
    â–¼
[localStorage]
    â”‚
    â”‚  key: `zk-d2-vote-reveal-{wallet}-{proposalId}`
    â”‚  value: { choice, numVotes, creditsSpent, voteSalt, nullifier, commitment }
    â”‚
    â–¼
[Reveal Phase]
    â”‚
    â”œâ”€ getD2VoteForReveal() â† localStorage ë¡œë“œ
    â”œâ”€ handleReveal() ì‹¤í–‰
    â”‚   â””â”€ revealVoteD2 TX
    â””â”€ markAsRevealed() â† ìƒíƒœ ì—…ë°ì´íŠ¸
```

### 4.2 ì»¨íŠ¸ë™íŠ¸ í˜¸ì¶œ ì‹œí€€ìŠ¤

**Reveal í˜¸ì¶œ**:
```typescript
const ZK_VOTING_FINAL_ABI = [
  // ... ê¸°ì¡´ ABI ...
  {
    type: 'function',
    name: 'revealVoteD2',
    inputs: [
      { name: '_proposalId', type: 'uint256' },
      { name: '_nullifier', type: 'uint256' },
      { name: '_choice', type: 'uint256' },
      { name: '_numVotes', type: 'uint256' },
      { name: '_voteSalt', type: 'uint256' }
    ],
    outputs: [],
    stateMutability: 'nonpayable'
  },
  {
    type: 'function',
    name: 'getPhaseD2',
    inputs: [{ name: '_proposalId', type: 'uint256' }],
    outputs: [{ name: '', type: 'uint8' }],
    stateMutability: 'view'
  }
] as const
```

---

## 5. ìƒíƒœ ê´€ë¦¬

### 5.1 Proposal ì¸í„°í˜ì´ìŠ¤ í™•ì¥
```typescript
interface Proposal {
  id: number
  title: string
  creator: string
  endTime: Date
  revealEndTime: Date      // ì¶”ê°€
  totalVotes: number       // totalCommitments
  creditRoot: bigint
  // Phase 2 ë°ì´í„°
  forVotes: number         // ì¶”ê°€
  againstVotes: number     // ì¶”ê°€
  revealedVotes: number    // ì¶”ê°€
  phase: 0 | 1 | 2         // ì¶”ê°€
}
```

### 5.2 ë‚´ íˆ¬í‘œ ìƒíƒœ
```typescript
interface MyVoteStatus {
  hasVoted: boolean        // localStorage ì²´í¬
  isRevealed: boolean      // ì»¨íŠ¸ë™íŠ¸ ì²´í¬ ë˜ëŠ” localStorage
  voteData: StoredVote | null
}
```

---

## 6. ì—ëŸ¬ ì²˜ë¦¬

### 6.1 Reveal ì—ëŸ¬ ë©”ì‹œì§€
| ì»¨íŠ¸ë™íŠ¸ ì—ëŸ¬ | ì‚¬ìš©ì ë©”ì‹œì§€ |
|--------------|--------------|
| NotInRevealPhase | ì•„ì§ ê³µê°œ ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤ |
| CommitmentNotFound | ì´ ì œì•ˆì— íˆ¬í‘œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤ |
| AlreadyRevealed | ì´ë¯¸ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤ |
| InvalidReveal | íˆ¬í‘œ ë°ì´í„°ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ |
| User rejected | íŠ¸ëœì­ì…˜ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤ |

### 6.2 ì—ëŸ¬ ë³µêµ¬
- localStorage ë°ì´í„° ì†ì‹¤ â†’ "íˆ¬í‘œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œ íˆ¬í‘œí–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ â†’ ì¬ì‹œë„ ë²„íŠ¼

---

## 7. UI/UX ìƒì„¸

### 7.1 Phase ì „í™˜ UX
```
[Commit Phase ì¢…ë£Œ 10ë¶„ ì „]
  â†’ "íˆ¬í‘œ ë§ˆê° ì„ë°•!" ê²½ê³  í‘œì‹œ

[Reveal Phase ì‹œì‘]
  â†’ "ê³µê°œ ê¸°ê°„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤" ì•Œë¦¼
  â†’ ë‚´ íˆ¬í‘œê°€ ìˆìœ¼ë©´ ê³µê°œ ë²„íŠ¼ ê°•ì¡°

[Reveal Phase ì¢…ë£Œ 1ì‹œê°„ ì „]
  â†’ "ê³µê°œ ë§ˆê° ì„ë°•!" ê²½ê³  í‘œì‹œ
  â†’ ë¯¸ê³µê°œ íˆ¬í‘œ ìˆìœ¼ë©´ ë¹¨ê°„ìƒ‰ ê°•ì¡°
```

### 7.2 ë¹„ìš© í‘œì‹œ ì •ì±…
- ì œì•ˆ ëª©ë¡: íˆ¬í‘œ ìˆ˜ë§Œ í‘œì‹œ (TON ë¹„ìš© X)
- Reveal UI: íˆ¬í‘œ ìˆ˜ë§Œ í‘œì‹œ (TON ë¹„ìš© X)
- ê²°ê³¼ UI: íˆ¬í‘œ ìˆ˜ë§Œ í‘œì‹œ (TON ë¹„ìš© X)

**ì´ìœ **: íˆ¬í‘œ ì‹œ ì´ë¯¸ ë¹„ìš© í™•ì¸í•¨. ì´í›„ ë¶ˆí•„ìš”.

### 7.3 ë¡œë”© ìƒíƒœ
| ì•¡ì…˜ | ë¡œë”© ë©”ì‹œì§€ |
|------|------------|
| Phase ì¡°íšŒ | "ìƒíƒœ í™•ì¸ ì¤‘..." |
| Reveal TX | "íˆ¬í‘œ ê³µê°œ ì¤‘..." |
| ê²°ê³¼ ì¡°íšŒ | "ê²°ê³¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..." |

---

## 8. êµ¬í˜„ ìˆœì„œ

### Step 1: ABI ë° íƒ€ì… ì¶”ê°€
```typescript
// contract.ts ë˜ëŠ” QuadraticVotingDemo.tsx
// revealVoteD2, getPhaseD2 ABI ì¶”ê°€
// Proposal ì¸í„°í˜ì´ìŠ¤ í™•ì¥
```

### Step 2: Phase ì¡°íšŒ ë¡œì§
```typescript
// useReadContractë¡œ getPhaseD2 í˜¸ì¶œ
// Proposalì— phase, revealEndTime, forVotes ë“± ì¶”ê°€
```

### Step 3: PhaseIndicator ì»´í¬ë„ŒíŠ¸
```typescript
// Phase í‘œì‹œ UI êµ¬í˜„
// ë‚¨ì€ ì‹œê°„ ì¹´ìš´íŠ¸ë‹¤ìš´
```

### Step 4: RevealForm ì»´í¬ë„ŒíŠ¸
```typescript
// localStorageì—ì„œ íˆ¬í‘œ ë°ì´í„° ë¡œë“œ
// revealVoteD2 TX í˜¸ì¶œ
// ì„±ê³µ/ì‹¤íŒ¨ ì²˜ë¦¬
```

### Step 5: VoteResult ì»´í¬ë„ŒíŠ¸
```typescript
// forVotes, againstVotes í‘œì‹œ
// ë¹„ìœ¨ ë°” ì‹œê°í™”
// ë‚´ íˆ¬í‘œ ìƒíƒœ í‘œì‹œ
```

### Step 6: QuadraticVotingDemo í†µí•©
```typescript
// Phaseë³„ UI ë¶„ê¸°
// ì»´í¬ë„ŒíŠ¸ import ë° ì—°ê²°
```

---

## 9. í…ŒìŠ¤íŠ¸ ê³„íš

### 9.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [ ] PhaseIndicator: ê° Phaseë³„ í‘œì‹œ í™•ì¸
- [ ] RevealForm: localStorage ë¡œë“œ í™•ì¸
- [ ] VoteResult: ë¹„ìœ¨ ê³„ì‚° ì •í™•ì„±

### 9.2 í†µí•© í…ŒìŠ¤íŠ¸ (Sepolia)
- [ ] Commit TX ì„±ê³µ â†’ localStorage ì €ì¥
- [ ] Phase 0 â†’ 1 ì „í™˜ í™•ì¸
- [ ] Reveal TX ì„±ê³µ â†’ forVotes ì¦ê°€
- [ ] Phase 1 â†’ 2 ì „í™˜ í™•ì¸
- [ ] ê²°ê³¼ í‘œì‹œ ì •í™•ì„±

### 9.3 ì—ëŸ¬ ì¼€ì´ìŠ¤
- [ ] Commit Phaseì—ì„œ Reveal ì‹œë„ â†’ revert
- [ ] ì¤‘ë³µ Reveal ì‹œë„ â†’ revert
- [ ] ì˜ëª»ëœ voteSalt â†’ revert

---

## 10. íŒŒì¼ë³„ ë³€ê²½ ì‚¬í•­

| íŒŒì¼ | ë³€ê²½ ë‚´ìš© | ìœ„í—˜ë„ |
|------|----------|:------:|
| `QuadraticVotingDemo.tsx` | Phase ë¶„ê¸°, ì»´í¬ë„ŒíŠ¸ import | ì¤‘ |
| `voting/PhaseIndicator.tsx` | ì‹ ê·œ ìƒì„± | ë‚®ìŒ |
| `voting/RevealForm.tsx` | ì‹ ê·œ ìƒì„± | ë‚®ìŒ |
| `voting/VoteResult.tsx` | ì‹ ê·œ ìƒì„± | ë‚®ìŒ |
| `voting/index.ts` | ì‹ ê·œ ìƒì„± (export) | ë‚®ìŒ |
| `App.css` | Phase/Reveal/Result ìŠ¤íƒ€ì¼ | ë‚®ìŒ |
| `zkproof.ts` | ë³€ê²½ ì—†ìŒ | - |

---

## Document History

| Date | Author | Change |
|------|--------|--------|
| 2026-02-11 | AI | ì´ˆê¸° Design ì‘ì„± |
